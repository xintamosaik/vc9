<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Preview</title>
    <style>
        .dash::before {
            content: "â€¢";
        }

        @media print {
            aside {
                display: none;
            }
        }
    </style>
</head>

<body>
    <aside>
        <nav>
            <a href="../" target="_blank">Home</a>
        </nav>
    </aside>
    <main>

        <section id="title">
            <h1>
                <span id="personal_name"></span>
                <span class="dash"></span>
                <span id="summary_title"></span>
            </h1>
            <script id="script_title">
                const first = localStorage.getItem("personal.first").trim() || "";
                const last = localStorage.getItem("personal.last").trim() || "";
                const full = (first && last) ? first + " " + last : "(please add your name to the personal section)";
                window.personal_name.innerText = full;

                const title = localStorage.getItem("summary.title").trim() || "";
                window.summary_title.innerText = title;

            </script>
        </section>

        <section id="contact">
            <span>
                <a id="contact_linkedin" target="_blank">
                    LinkedIn
                </a>
            </span>
            <span class="dash"></span>
            <span>
                <a id="contact_email">
                    Email
                </a>
            </span>
            <span class="dash"></span>
            <span>
                <a id="contact_github" target="_blank">
                    GitHub
                </a>
            </span>
            <span class="dash"></span>
            <span id="personal_city"></span>
            <script id="script_contact">
                const email = localStorage.getItem("contact.email").trim() || "";
                window.contact_email.href = `mailto:${email}`;
                window.contact_email.innerText = email;

                const linkedin = localStorage.getItem("contact.linkedin").trim() || "";
                window.contact_linkedin.href = linkedin;

                const github = localStorage.getItem("contact.github").trim() || "";
                window.contact_github.href = github;

                const city = localStorage.getItem("personal.city").trim() || "";
                window.personal_city.innerText = city;
            </script>
        </section>

        <!-- SUMMARY-->

        <section id="summary">
            <h2>Summary</h2>
            <p id="summary_text">

            </p>
            <script id="script_summary">
                const summary = localStorage.getItem("summary.description").trim() || "";
                window.summary_text.innerText = summary;

            </script>
        </section>

        <!-- EXPERIENCE-->

        <section id="experience">
            <h2>Experience</h2>
            <template id="job">
                <div class="job entry">
                    <h3>
                        <span class="title"></span>
                        <span class="dash"></span>
                        <span class="company"></span>
                    </h3>
                    <h4>
                        <span class="date"></span>
                        <span class="dash"></span>
                        <span class="city"></span>
                    </h4>


                    <p class="description">

                    </p>

                </div>
            </template>

            <script id="script_experience">
                const filtered_work = Object.entries(localStorage).filter(([key, value]) =>
                    key.startsWith("work.")
                );

                filtered_work.forEach((entry) => {
                    const deserialized = JSON.parse(entry[1]);

                    const job = window.job.content.cloneNode(true);

                    const title = deserialized.title;
                    const title_html = job.querySelector(".title");
                    title_html.innerText = title;

                    const company = deserialized.company;
                    const company_html = job.querySelector(".company");
                    company_html.innerText = company;

                    const city = deserialized.city;
                    const city_html = job.querySelector(".city");
                    city_html.innerText = city;

                    const start = deserialized.start;
                    const end = deserialized.end || "present";
                    const date = start + " - " + end;
                    const date_html = job.querySelector(".date");
                    date_html.innerText = date;

                    window.experience.appendChild(job);
                }); 
            </script>
        </section>

        <!-- SKILLS -->

        <section id="skills">
            <h2>Skills</h2>
            <template id="skill">
                <div class="skill entry">
                    <h3>
                        <span class="name"></span>
                        <span class="dash"></span>
                        <span class="level"></span>

                    </h3>
                </div>
            </template>
            <script id="script_skills">
                const filtered_skills = Object.entries(localStorage).filter(([key, value]) =>
                    key.startsWith("skill.")
                );

                filtered_skills.forEach((entry) => {
                    const deserialized = JSON.parse(entry[1]);
                    console.log(deserialized);

                    const skill = window.skill.content.cloneNode(true);
                    const name = deserialized.name;
                    const name_html = skill.querySelector(".name");
                    name_html.innerText = name;

                    const level = deserialized.level;
                    let level_category = "beginner";
                    if (level > 66) {
                        level_category = "expert";
                    } else if (level > 33) {
                        level_category = "intermediate";
                    }
                    const level_html = skill.querySelector(".level");
                    level_html.innerText = level_category;

                    // We need to treat this differently in the future.
                    // const category = deserialized.category;
                    // const category_html = skill.querySelector(".category");
                    // category_html.innerText = category;

                    window.skills.appendChild(skill);
                });
            </script>
        </section>

        <!-- EDUCATION -->

        <section id="educations">

            <h2>Education</h2>
            <template id="education">
                <div class="education entry">
                    <h3>
                        <span class="subject"></span>
                        <span class="dash"></span>
                        <span class="university"></span>
                    </h3>
                    <h4>
                        <span class="date"></span>
                        <span class="dash"></span>
                        <span class="city"></span>
                    </h4>
                    <h4>
                        <span class="degree"></span>
                    </h4>
                    <p class="description"></p>
                </div>
            </template>
            <script id="script_education">
                const filtered_education = Object.entries(localStorage).filter(([key, value]) =>
                    key.startsWith("education.")
                );

                filtered_education.forEach((entry) => {
                    const deserialized = JSON.parse(entry[1]);
            

                    const education = window.education.content.cloneNode(true);
                    const subject = deserialized.subject;
                    const subject_html = education.querySelector(".subject");
                    subject_html.innerText = subject;

                    const degree = deserialized.degree;
                    const degree_html = education.querySelector(".degree");
                    degree_html.innerText = degree;

                    const city = deserialized.city;
                    const city_html = education.querySelector(".city");
                    city_html.innerText = city;

                    const start = deserialized.start;
                    const end = deserialized.end || "present";
                    const date = start + " - " + end;
                    const date_html = education.querySelector(".date");
                    date_html.innerText = date;

                    window.educations.appendChild(education);
                });
            </script>

        </section>

    </main>



</body>

</html>